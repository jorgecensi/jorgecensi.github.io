<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossFit Timer - Modern Workout Timer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
/* ... existing styles ... */

.cf-timer-circle-container {
    position: relative;
    display: inline-block;
}
.cf-timer-display {
    position: relative;
    z-index: 2;
    width: 200px;
    height: 200px;
    line-height: 200px;
    text-align: center;
    font-size: 5rem;
    font-weight: 700;
    color: var(--primary-color);
    background: transparent;
    margin: 2rem 0;
}
.countdown-ring {
    position: absolute;
    top: 0; left: 0;
    z-index: 1;
    pointer-events: none;
}
.countdown-ring circle {
    stroke: var(--accent-color, #f59e42);
    stroke-width: 10;
    fill: none;
    stroke-linecap: round;
    transition: stroke-dashoffset 1s linear;
    opacity: 0;
}
.timer-countdown + .countdown-ring circle,
.cf-timer-circle-container.countdown-active .countdown-ring circle {
    opacity: 1;
}

/* ... rest of your styles ... */
    </style>
</head>
<body>
<div class="cf-container">
    <div class="cf-header">
        <h1 class="cf-title">CrossFit Timer</h1>
        <p class="cf-subtitle">Professional workout timer for all your training needs</p>
    </div>

    <!-- Timer Selection -->
    <!-- ... (keep your timer config section as is) ... -->

    <!-- Main Timer Display -->
    <div class="cf-section">
        <div class="cf-card">
            <div class="cf-card-body cf-timer-body">
                <!-- Workout Type Display -->
                <!-- ... (keep your workout info and phase badge sections as is) ... -->

                <!-- Main Timer with circle -->
                <div id="timer-circle-container" class="cf-timer-circle-container">
                    <div id="timer-display" class="cf-timer-display">
                        00:00
                    </div>
                    <svg class="countdown-ring" id="countdown-ring" width="200" height="200">
                        <circle r="95" cx="100" cy="100" />
                    </svg>
                </div>

                <!-- Progress Bar -->
                <!-- ... (keep your progress bar and controls as is) ... -->
            </div>
        </div>
    </div>
</div>

<script>
class CrossFitTimer {
    constructor() {
        this.currentWorkout = null;
        this.isRunning = false;
        this.isPaused = false;
        this.timeRemaining = 0;
        this.totalTime = 0;
        this.currentRound = 1;
        this.totalRounds = 1;
        this.currentPhase = 'countdown'; // countdown, work, rest, finished
        this.countdownTime = 10;
        this.intervalId = null;
        this.audioContext = null;

        this.initializeElements();
        this.bindEvents();
        this.initializeAudio();
    }

    initializeElements() {
        this.workoutBtns = document.querySelectorAll('.workout-type-btn');
        this.configSections = document.querySelectorAll('.cf-config-section');
        this.timerDisplay = document.getElementById('timer-display');
        this.workoutInfo = document.getElementById('workout-info');
        this.currentWorkoutType = document.getElementById('current-workout-type');
        this.roundInfo = document.getElementById('round-info');
        this.currentRoundSpan = document.getElementById('current-round');
        this.totalRoundsSpan = document.getElementById('total-rounds');
        this.timerPhase = document.getElementById('timer-phase');
        this.phaseBadge = document.getElementById('phase-badge');
        this.progressContainer = document.getElementById('progress-container');
        this.progressBar = document.getElementById('progress-bar');
        this.startBtn = document.getElementById('start-btn');
        this.pauseBtn = document.getElementById('pause-btn');
        this.resumeBtn = document.getElementById('resume-btn');
        this.stopBtn = document.getElementById('stop-btn');
        this.resetBtn = document.getElementById('reset-btn');
        this.soundEnabled = document.getElementById('sound-enabled');
        this.volumeControl = document.getElementById('volume-control');
        // For circle
        this.circleContainer = document.getElementById('timer-circle-container');
        this.countdownRing = document.getElementById('countdown-ring');
        this.countdownCircle = this.countdownRing ? this.countdownRing.querySelector('circle') : null;
    }

    // ... keep the rest of your logic as-is, but update updateDisplay:

    updateDisplay() {
        const minutes = Math.floor(Math.abs(this.timeRemaining) / 60);
        const seconds = Math.abs(this.timeRemaining) % 60;
        const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        this.timerDisplay.textContent = display;

        // --- Circle logic: show/hide and animate during countdown ---
        if (this.countdownCircle && this.currentPhase === 'countdown') {
            const radius = this.countdownCircle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            this.countdownCircle.style.strokeDasharray = `${circumference}`;
            const progress = (this.countdownTime - this.timeRemaining) / this.countdownTime;
            const offset = circumference * (1 - progress);
            this.countdownCircle.style.strokeDashoffset = offset;
            this.countdownCircle.style.opacity = 1;
            this.circleContainer.classList.add('countdown-active');
        } else if (this.countdownCircle) {
            this.countdownCircle.style.opacity = 0;
            this.circleContainer.classList.remove('countdown-active');
        }
    }

    // ... keep the rest of your CrossFitTimer class code as is ...
}

// Initialize timer when page loads
document.addEventListener('DOMContentLoaded', () => {
    new CrossFitTimer();
});

// Service Worker Registration for PWA
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('SW registered'))
            .catch(error => console.log('SW registration failed'));
    });
}
</script>
</body>
</html>